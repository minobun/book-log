# マイクロサービスアーキテクチャ
## 感想
### 自分の現在の業務として
あまり直接役に立つないようではないが、将来的に役に立つ。
技術選定の際の考え方の一つとして利用したい。
小さなアプリケーションでは出る機会が少ないような気がしている。

### 進化的アーキテクトの章
あまりイメージがわかなかった。
アーキテクトとしての理想的なあり方があるよというのだけわかった。


## メモ

マイクロサービスは、連携して動作する独自のライフサイクルを備えた粒度の細かいサービスの利用を促進する、分散システムへの取り組み

マイクロサービスは主にビジネスドメインに基づいてモデル化することで、従来の階層型アーキテクチャの問題を避けている。

サービス思考アーキテクチャの実装の欠点を避けることができる。

### マイクロサービス

DDD：実世界をコードで表すことの重要性の理解を促し、システムをモデル化するよりより方法を示した。
CD：ソフトウェアをより効果的かつ効率的に本番環境にデプロイできる方法を示し、すべてのチェックインをリリース候補として扱うべきとする考え方をもたらした。
ヘキサゴナルアーキテクチャ：ビジネスロジックが隠れることがある階層化アーキテクチャから離れるように導いた。
オンデマンド仮想化
インフラ自動化
小規模で自律的なチーム
大規模システム

これらの世界からマイクロサービスは生まれた。

1. 小さく、かつ一つの役割に専念
   1. モノリシックシステムの中では、多くの場合、抽象化を行いモジュールを作成することでコードの凝集性がより高まるようにして、修正や実装が困難にならないようにしている。
      1. 凝集性：関連するコードが集まるようにすること
      2. 単一責任の原則でその認識が強化された。（プログラマが知るべき97のこと）
         1. 変更する遺留が同じものは集める。変更する理由が異なるものは分ける。
   2. どの程度小さくするのか：大きすぎると感じなくなるまで。おおよそサービスがチームの構造とどの程度一致しているかは大きな観点の一つ
   3. サービスが小さければ小さいほど、マイクロサービスアーキテクチャの利点と欠点が最大化される。
2. 自律性
   1. サービス間のすべての通信はネットワーク呼び出しを経由し、サービス間の分離を強制し、蜜結合のリスクを回避する。
   2. サービスはそれぞれ独立して変更でき、コンシューマーを変更する必要なく、単独でデプロイできなければならない。
   3. 黄金律「ほかには何も変更せずに、単独でサービスの変更やデプロイを行えるか」

利点
利点の多くは、分散システムによるもの
1. 技術異質性
   1. サービスごとに異なる技術を使う決断をできる。
2. 回復性
   1. レジリエンスエンジニアリングとして主要な考え方の隔壁：サービス境界
   2. モノリシックではすべてが停止する。
3. スケーリング
   1. 個々の小さなサービスのうちスケーリングが必要なサービスだけをスケールできる。
4. デプロイの容易性
5. 組織面の一致
   1. 小規模コードベースで作業する小規模チームのほうが生産性が高い傾向にある。
6. 合成可能性
   1. 機能を再利用する機会を広げられる。
   2. Web、ネイティブアプリケーション、モバイルWeb、タブレットアプリ、ウェアラブルデバイス向けの機能を組み込む無数の方法を考える必要がある。
   3. 外部からアドレス可能な接合部を増やすことで再利用しやすい
7. 交換可能にするための最適化
   1. 既存のコードを優れた実装に置き換えやすい

サービス指向アーキテクチャ：複数のサービスが連携して、最終的な一連の機会を提供する設計手法
- サービス間の通信はプロセス境界内のメソッド呼び出してはなく、ネットワークを介した呼び出しで行われる。
- 大規模なモノリシックアプリケーションの課題解決として登場
- ソフトウェアの再利用性の促進を目指す手法
- しかし、「適切に」実現する方法には十分な合意が欠けている。
- 通信プロトコル、ベンダミドルウェア、サービス粒度に関する指針の欠如、などなど説明不足のようだ

マイクロサービスはSOAを適切に実現する。

ほかの分解テクニック
- 共有ライブラリ：便利なユーティリティー群や再利用可能な統計ライブラリなど
  - 技術的多様性が失われる
    - ライブラリは同じ言語であるか、同じプラットフォーム上で動作する必要がある
- モジュール
  - 独自のモジュール式分解テクニックを提供する言語もある。
  - 例
    - OSGI：ライブラリを介してモジュールの概念をJavaに組み込む手段として使われる
      - 言語自体の十分なサポートなしにモジュールのライフサイクル管理などを行おうとする問題がある。
      - 適切なモジュール分離には多くの作業が必要となる。
    - Erlang：優れた機能を持つが、、
      - 共有ライブラリと同様の問題を持つ。

銀の弾丸はないらしい。


### 進化的アーキテクト
アーキテクトの役割は変化する。
通常の建築士と比べてユーザーの要件に柔軟に合わせる必要がある。

アーキテクトは完璧な最終製品を作成するという考え方を変え、代わりに適切なシステムが得られるようなフレームワークを作成することに重点をおき、さらに学んで成長を続ける必要がある。

ただし、ITアーキテクトは都市計画家と似ている。

アーキテクトはコーディングするとよりよい。


原則に基づいたアプローチ
　規則は愚者が従うべきもので、賢者の手引きである。

- 戦略的目標
  - 戦略的目標は組織が目指す方向性なので、技術がその目標に一致するようにする必要がある。
- 原則
  - 実行することを大きな目標に一致させるために作成した規則である。
  - 時々変更される。
- プラクティス
  - 原則を確実に実行する方法
  - タスクを実行するための詳細で実用的な一連の指針
- 原則とプラクティスの結合
- 実世界の例


|戦略的目標|アーキテクチャ上の原則|設計とデリバリのプラクティス|
|--|--|--|

- スケーラブルなビジネスを可能にする
  - 顧客と取引の増加
  - 顧客へのセルフサービス
- 新しい市場への参入のサポート
  - 柔軟な運用プロセス
  - 新製品と運用プロセス
- 既存市場での革新のサポート
  - 柔軟な運用プロセス
  - 新製品と運用プロセス

- 惰性の削減
- 予想外の複雑さの排除
- 一貫性のあるインタフェースとデータフロー
- 銀の弾丸などない


設計とデリバリのプラクティス
- 標準のREST/HTTP
- レガシーのカプセルか
- 統合データベースの排除
- データの統合とクレンジング
- 公開された統合モデル
- 小規模な独立サービス
- 継続的デプロイ
- 商用製品/SaaSの最小限のカスタマイズ

必要な標準
- 監視
  - すべてのサービスで健全性と一般的な監視関連のメトリックを同じように出力するとよい。
- インタフェース
  - 少数の定義済みインタフェース技術がよいらしい。
- アーキテクチャ上の安全性
  - 不健全な下流呼び出しから適切に身を守る
  - 適切なレスポンスコード


手本とサービステンプレート

### サービスのモデル化方法
優れたサービス
- 疎結合
  - 連携するサービスに対して最低限のことだけしかしないよ。
- 高凝集性
  - 関連する振る舞いを一緒にし、関連のない振る舞いは別の場所に配置したい
境界付けられたコンテキスト
- どのドメインも複数の境界づけられたコンテキストからなり、それぞれの境界づけられたコンテキストには外部と通信する必要のないものと、外部の他の境界づけられたコンテキストと共有されるものがある。
- 「細胞膜が内外を分け、通過できるものを決めているので、細胞が存在できます。」
- 共有モデルと隠れモデル
- モジュールとサービス

# 統合
1. 理想的な統合技術の探索
   1. 破壊的変更を回避する
   2. APIを技術非依存にする
   3. コンシューマにとって単純なサービスにする
   4. 内部の実装詳細を隠す
2. 顧客とのインタフェース
3. 共有データベース







